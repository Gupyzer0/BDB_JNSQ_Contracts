<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <style>
        #tree {
            width:100%;
            height: 600px;
            overflow: scroll
        }
    </style>
</head>

<body>
    <div class="container">
        
        <div class="card mt-5">

            <div class="card-header">
                Filters
            </div>

            <div class="card-body">

                <form>

                    <div class="row">
        
                        <div class="col-auto">
                            <label for="filter" class="form-label">Type</label>
                            <select id="filter" class="form-select">
                                <option value="">All</option>
                                <option value="alternate_history">Alternate History</option>
                            </select>
                        </div>
                        
                        <div class="col-auto">
                            <label for="list" class="form-label">Missions</label>
                            <select class="form-select" id="list"></select>
                        </div>
        
                    </div>
                    
                </form>

                <button class="btn btn-secondary" id="form-expand">Expand All</button>

                <div>
                    <div id="tree"></div>
                </div>

            </div>
            

        </div>
        

   
        

    </div>
    

</body>

<script type="text/javascript" src="dependentree.js"></script>
<script type="text/javascript" src="missions.js"></script>
<script>
    treeOptions = ({
        maxDepth: 50,
        containerWidthMultiplier: 8,
    })
    const tree = new DependenTree('div#tree', treeOptions);
    tree.addEntities(missions);

    const entityList = tree.getEntityList()

    const entitySelect = document.getElementById('list');
    const filterSelect = document.getElementById('filter');

    const populateEntitySelect = entityList => {
        entityList.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            const text = document.createTextNode(name);
            option.appendChild(text);
            entitySelect.appendChild(option);
        });
    }

    const allEntities = tree.getEntityList();
    populateEntitySelect(allEntities);

    let currentEntity = 'Explorer-1';
    let direction = 'downstream';

    filterSelect.addEventListener('change', e => {
        entitySelect.innerHTML = '';

        const value = e.target.value;
        let filteredList;
        if (value === '') {
            filteredList = tree.getEntityList();
        } else if(value === 'alternate_history') {
            filteredList = tree.getEntityList('_alternate_history', "true");
        } else if(value === 'manned') {
            filteredList = tree.getEntityList('_manned', "true");
        }

        populateEntitySelect(filteredList);

        setTimeout(() => {
            tree.setTree(entitySelect.value, direction);
        }, 100);
    });

    entitySelect.addEventListener('change', e => {
        if (e.target.value === '') return;
        currentEntity = e.target.value;
        tree.setTree(currentEntity, direction);
    });

    document.querySelector('button#form-expand').addEventListener('click', () => tree.expandAll());

    tree.setTree(currentEntity, direction);


</script>

</html>