CONTRACT_TYPE
{
    name = Gambit_KH7
    group = GambitKH7
	title = Perform photo surveillance from a polar orbit of @targetBody.

	description = BYEMAN codenamed GAMBIT, the KH-7 (Air Force Program 206) is a reconnaissance satellite that, like the CORONA program satellites, acquires imagery intelligence by taking photographs and returning the undeveloped film to Earth. The spacecraft is a 3-axis-stabilized satellite that separates from the Agena-D and contains the payload, camera system, and reentry vehicle (SRV). It's known as the OCV (Orbital Control Vehicle). The OCV body is a long cylinder, 1.52 meters in diameter and about 5.0 meters long, ending in a conical adapter connected to the SRV. The SRV is a 0.8 m long, 0.7 m diameter rounded cone with a mass of about 160 kg containing a Thiokol Star 12 retrorocket, with a mass of 33 kg full and 10 kg empty. The OCV was launched into a low-altitude sun-synchronous orbit on an Atlas Agena-D rocket.

	notes = The KH-7 was first successfully launched by a Atlas LV-3A Agena-D on July 12, 1963, from the Vandenberg AFB Launch Complex.
    synopsis = <color=yellow>Launch a KH-7 Gambit surveillance satellite into space around @targetBody and perform photo surveillance of the specified areas.</color>
    completedMessage = Mission Success!.

    agent = nro
 	maxCompletions = 54 // 54 KH-8 missions flown
    maxSimultaneous = 1
	deadline = 90
	minExpiry = 90
	maxExpiry = 90
	cancellable = true
    declinable = true
	advanceFunds = Random(@Blue_Dog_Design_Bureau_Contracts:Kerbucks075,@Blue_Dog_Design_Bureau_Contracts:Kerbucks1)
    rewardFunds = Random(@Blue_Dog_Design_Bureau_Contracts:Kerbucks105,@Blue_Dog_Design_Bureau_Contracts:Kerbucks2)
    rewardReputation = Random(4.0, 8.0)

    targetBody = HomeWorld()
	
    // Hardcoded list of specific experiments
    DATA
    {
        name = experimentslist
		title = experimentslist
		type = List<ScienceExperiment>
        hidden = true

        experiments = [bd_surveillance]
    }
	
	// Randomly select 4 valid biomes to study from low space.
    DATA
    {
		type = List<ScienceSubject>
        hidden = true

        scienceSubjectsTemp1 = AllScienceSubjectsByBodyExperiment([@targetBody], @experiments)
		scienceSubjectsTemp2 = @scienceSubjectsTemp1.Where(s => !s.Biome().IsKSC())
		scienceSubjectsTemp3 = @scienceSubjectsTemp2.Where(s => s.Situation() == InSpaceLow)
        scienceSubjects = @scienceSubjectsTemp3.Random(4)
    }
	
	PARAMETER
    {
        name = Gamble Surveillance Satellite
        type = VesselParameterGroup
        title = Launch a new Gamble surveillance satellite
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = The satellite must be a new vessel
		}
		
		PARAMETER
		{
			name = Crewmembers
			type = HasCrew
			minCrew = 0
			maxCrew = 0
		}

		// Required Parts ---------------------------------
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Pod
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Parachute
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Heatshield
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Retro
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Decoupler_0p9375m
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Keyhole_RVAdapter
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Keyhole_Camera_KH7
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Keyhole_OCV_KH7
			disableOnStateChange = True
		}
		// /Required Parts ---------------------------------
		
		//Orbit with random components to be both somewhat unpredictable and scalable to any size body. PeA needs to be below High Space to ensure both space situations are guaranteed to be within the parameters.
		PARAMETER
		{
			name = Orbit
			type = Orbit
			title = Achieve the specified polar low space orbit
			
			maxApA = @targetBody.SpaceAltitudeThreshold()
			maxEccentricity = 0.02
			minInclination = Random(70,85)
			maxInclination = Random(90,105)
			disableOnStateChange = true
		}
    }

	PARAMETER
	{
		name = CollectScience
		type = CollectScience

		title = Take photos of the specified areas
		biome = @scienceSubject.Biome()
		situation = @scienceSubject.Situation()
		experiment = @scienceSubject.Experiment()
		recoveryMethod = Recover

		ITERATOR
		{
			type = ScienceSubject
			scienceSubject = @/scienceSubjects
		}
	}
	
	PARAMETER
	{
		name = ReturnHome
		type = ReturnHome
		title = Recover the film canister
	}
		
	// This requirement specifies the nodes that the parts with the required experiments currently reside in. Deliberately not specifying particular parts, so any part with the experiment can be used. If all applicable parts get placed to later nodes, could lead to issues however.
	REQUIREMENT
    {
        name = TechResearched
		type = TechResearched
		tech = basicScience
    }
	
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = Corona_KH4B
		minCount = 3
		cooldownDuration = 0d
	}

	// Deactivate this if 6 KH-8 missions are flown
	REQUIREMENT
    {
		name = Any
		type = Any

        REQUIREMENT
        {
            name = CompleteContract
            type = CompleteContract
            contractType = Gambit3_KH8
            minCount = 6
            cooldownDuration = 0d
        }
    }

}
