CONTRACT_TYPE
{
    name = Corona_KH4
    group = CoronaProgram
	title = Perform photo reconnaissance from a polar orbit of @targetBody.
    genericTitle = Perform photo reconnaissance.

	description = The KH-4 payload introduces a second camera to provide stereoscopic imaging. The Corona-M or Mural camera consists of two C''' (Corona triple-prime). The cameras are mounted with 30 degrees separation angle. The two cameras are referred to as fore (for forward-looking) and aft (for rear looking). KH-4 also carries a 4 cm index camera, with a focal length of 38 mm, a ground resolution of 162 m, and frame coverage of 308 km Ã— 308 km. The satellite is based on the Agena-B upper stage.
    genericDescription = Perform photo reconnaissance of the specified areas.
	
	notes = The KH-4 was first successfully launched by a Thor Agena-B as Discoverer-38 on February 27, 1962, from the Vandenberg AFB Launch Complex. 
    synopsis = <color=yellow>Launch a KH-4 recon satellite into space around @targetBody and perform photo recon of the specified areas.</color>
    completedMessage = Mission Success!.

    agent = nro
    maxCompletions = 26 // KH-4 missions flown
    maxSimultaneous = 1
	deadline = 90
	minExpiry = 90
	maxExpiry = 90
	advanceFunds = Random(@Blue_Dog_Design_Bureau_Contracts:Kerbucks05,@Blue_Dog_Design_Bureau_Contracts:Kerbucks075)
    rewardFunds = Random(@Blue_Dog_Design_Bureau_Contracts:Kerbucks105,@Blue_Dog_Design_Bureau_Contracts:Kerbucks2)
    rewardReputation = Random(4.0, 8.0)

    targetBody = HomeWorld()
	
    // Hardcoded list of specific experiments
    DATA
    {
        name = experimentslist
		title = experimentslist
		type = List<ScienceExperiment>
        hidden = true

        experiments = [bd_mapping]
    }
	
	// Randomly select 3 valid biomes to study from low space.
    DATA
    {
		type = List<ScienceSubject>
        hidden = true

        scienceSubjectsTemp1 = AllScienceSubjectsByBodyExperiment([@targetBody], @experiments)
		scienceSubjectsTemp2 = @scienceSubjectsTemp1.Where(s => !s.Biome().IsKSC())
		scienceSubjectsTemp3 = @scienceSubjectsTemp2.Where(s => s.Situation() == InSpaceLow)
        scienceSubjects = @scienceSubjectsTemp3.Random(3)
    }
	
	PARAMETER
    {
        name = KH-4 Recon Satellite
        type = VesselParameterGroup
        title = Launch a new KH-4 Corona recon satellite
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = The satellite must be a new vessel
		}
		
		PARAMETER
		{
			name = Crewmembers
			type = HasCrew
			minCrew = 0
			maxCrew = 0
		}

		// Required Parts ---------------------------------
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Retro
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Heatshield
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Pod
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Parachute
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Keyhole_Camera_KH4
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Agena_Avionics
			disableOnStateChange = True
		}cia
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Agena_Tank_Long
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Agena_EngineMount
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Agena_EngineShroud
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Agena_Engine_XLR81
			disableOnStateChange = True
		}
		// /Required Parts ---------------------------------
		
		//Orbit
		PARAMETER
		{
			name = Orbit
			type = Orbit
			title = Achieve the specified polar low space orbit
			
			maxApA = Random(0.4,0.5) * @targetBody.SpaceAltitudeThreshold()
			maxPeA = (Random(0.3,0.4) * @targetBody.SpaceAltitudeThreshold()) < @targetBody.AtmosphereAltitude() ? @targetBody.AtmosphereAltitude() :  (Random(0.3,0.4) * @targetBody.SpaceAltitudeThreshold())
			maxEccentricity = 0.1
			minInclination = Random(70,85)
			maxInclination = Random(90,105)
			disableOnStateChange = true
		}
    }

	PARAMETER
	{
		name = CollectScience
		type = CollectScience

		title = Take a photo of the specified area
		biome = @scienceSubject.Biome()
		situation = @scienceSubject.Situation()
		experiment = @scienceSubject.Experiment()
		recoveryMethod = Recover

		ITERATOR
		{
			type = ScienceSubject
			scienceSubject = @/scienceSubjects
		}
	}
	
	PARAMETER
	{
		name = ReturnHome
		type = ReturnHome
		title = Recover the film canister
	}
	
	// This requirement specifies the nodes that the parts with the required experiments currently reside in. Deliberately not specifying particular parts, so any part with the experiment can be used. If all applicable parts get placed to later nodes, could lead to issues however.
	REQUIREMENT
    {
		name = Any
		type = Any
		
		REQUIREMENT
		{
			name = TechResearchedA
			type = TechResearched
			tech = stability
		}
		
		REQUIREMENT
		{
			name = TechResearchedB
			type = TechResearched
			tech = basicScience
		}

        REQUIREMENT
        {
            name = CompleteContract
            type = CompleteContract
            contractType = Corona_KH1
            minCount = 5
            cooldownDuration = 0d
        }
    }

    // Deactivate this if a KH-4A mission is flown
	REQUIREMENT
    {
        name = Any
		type = Any
		invertRequirement = true
		
		REQUIREMENT
        {
            name = CompleteContract
            type = CompleteContract
            contractType = Corona_KH4A
            minCount = 1
            cooldownDuration = 0d
        }
    }
}
