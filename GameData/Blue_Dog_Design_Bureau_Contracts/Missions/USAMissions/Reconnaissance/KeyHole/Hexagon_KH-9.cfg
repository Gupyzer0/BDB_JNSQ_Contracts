CONTRACT_TYPE
{
    name = Hexagon_KH9
    group = HexagonKH9
	title = Perform photo surveillance from a polar orbit of @targetBody.

	description = The KH-9 (Keyhole-9), also known as Hexagon or unofficially as "Big Bird", is a large reconnaissance satellite to replace the earlier KH-4B Corona satellites. In contrast to earlier models, it's not based on the Agena stage, but on a new maneuverable bus called SCS (Satellite Control Section). It features four return capsules for a much increased lifetime and a mapping Camera System (MCS) mounted on the forward end with an own smaller Mk.5 return capsule.

	notes = The KH-9 was first successfully launched by a Titan IIID on June 15, 1971, from the Vandenberg AFB Launch Complex.
    synopsis = <color=yellow>Launch a KH-9 Gambit surveillance satellite into space around @targetBody and perform photo surveillance of the specified areas.</color>
    completedMessage = Mission Success!.
  
    agent = nro
 	maxCompletions = 20 //KH-9 missions flown, all blocks
    maxSimultaneous = 1
    targetBody = HomeWorld()
	deadline = 0
	minExpiry = 0
	maxExpiry = 0
	advanceFunds = Random(@Blue_Dog_Design_Bureau_Contracts:Kerbucks1,@Blue_Dog_Design_Bureau_Contracts:Kerbucks2)
    rewardFunds = Random(@Blue_Dog_Design_Bureau_Contracts:Kerbucks105,@Blue_Dog_Design_Bureau_Contracts:Kerbucks2)
    rewardReputation = Random(4.0, 8.0)
	rewardScience = 4
	
    // Hardcoded list of specific experiments
    DATA
    {
        name = experimentslist
		title = experimentslist
		type = List<ScienceExperiment>
        hidden = true

        experiments = [bd_surveillance, bd_mapping]
    }
	
	// Randomly select 5 valid biomes to study from low space.
    DATA
    {
		type = List<ScienceSubject>
        hidden = true

        scienceSubjectsTemp1 = AllScienceSubjectsByBodyExperiment([@targetBody], @experiments)
		scienceSubjectsTemp2 = @scienceSubjectsTemp1.Where(s => !s.Biome().IsKSC())
		scienceSubjectsTemp3 = @scienceSubjectsTemp2.Where(s => s.Situation() == InSpaceLow)
        scienceSubjects = @scienceSubjectsTemp3.Random(5)
    }
	
	PARAMETER
    {
        name = Hexagon Surveillance Satellite
        type = VesselParameterGroup
        title = Launch a new Hexagon surveillance satellite
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = The satellite must be a new vessel
		}
		
		PARAMETER
		{
			name = Crewmembers
			type = HasCrew
			minCrew = 0
			maxCrew = 0
		}
        
		// Required Parts ---------------------------------
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_ServiceModule
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_ServiceEngine
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_MainRCS //2
            minCount = 2
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_LifeboatRCS //2
            minCount = 2
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_SolarPanel //2
            minCount = 2
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_FairingBase_SAF
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_Camera
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_AdapterSegment
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_Mk8_Retro //4
            minCount = 4
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_Mk8_Parachute //4
            minCount = 4
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_Mk8_Capsule //4
            minCount = 4
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_Mk8_Heatshield //4
            minCount = 4
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_TrussSegment //3
            minCount = 3
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_MappingCamera
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Hexagon_VHF_Bent
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Retro
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Parachute
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Pod
			disableOnStateChange = True
		}
        PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Heatshield
			disableOnStateChange = True
		}
		// /Required Parts ---------------------------------

		//Orbit with random components to be both somewhat unpredictable and scalable to any size body. PeA needs to be below High Space to ensure both space situations are guaranteed to be within the parameters.
		PARAMETER
		{
			name = Orbit
			type = Orbit
			title = Achieve the specified polar low space orbit
			
			maxApA = @targetBody.SpaceAltitudeThreshold()
			maxEccentricity = 0.02
			minInclination = Random(70,85)
			maxInclination = Random(90,105)
			disableOnStateChange = true
		}
    }

	PARAMETER
	{
		name = CollectScience
		type = CollectScience

		title = Take photos of the specified areas
		biome = @scienceSubject.Biome()
		situation = @scienceSubject.Situation()
		experiment = @scienceSubject.Experiment()
		recoveryMethod = Recover

		ITERATOR
		{
			type = ScienceSubject
			scienceSubject = @/scienceSubjects
		}
	}
	
	PARAMETER
	{
		name = ReturnHome
		type = ReturnHome
		title = Recover the film canisters
	}
		
	// This requirement specifies the nodes that the parts with the required experiments currently reside in. Deliberately not specifying particular parts, so any part with the experiment can be used. If all applicable parts get placed to later nodes, could lead to issues however.
	REQUIREMENT
    {
        name = TechResearched
		type = TechResearched
		tech = basicScience
    }
	
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = Gambit3_KH8
		minCount = 4
		cooldownDuration = 0d
	}

}
