CONTRACT_TYPE
{
    name = Corona_KH4B
    group = CoronaProgram
	title = Perform photo reconnaissance from a polar orbit of @targetBody.

	description = Perform photo reconnaissance of the specified areas.
	
    synopsis = Launch a Keyhole KH-4B recon satellite with an Agena-D upperstage into space around @targetBody and perform photo recon of the specified areas.
    completedMessage = Mission Success!.

    agent = nro
	cancellable = true
	declinable = true
	autoAccept = false
	minExpiry = 0
	maxExpiry = 0
	maxCompletions = 17
	maxSimultaneous = 1
	deadline = 30

	targetBody = HomeWorld()
	
	// ************ REWARDS ************
	prestige = Trivial  // Significant //Exceptional
	advanceFunds = @rewardReputation * @SpacelinesContracts:KerbucksTrivial
	rewardFunds = @advanceFunds * @SpacelinesContracts:KerbucksRewardTrivial
	failureFunds = @advanceFunds * 1.1
	rewardScience = 0
	rewardReputation = 70
	failureReputation = 0 // was @rewardReputation

	// ************ REQUIREMENTS ************

	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = Corona_KH4A
		minCount = 1
		cooldownDuration = 0d
	}
	
    // Hardcoded list of specific experiments
    DATA
    {
        name = experimentslist
		title = experimentslist
		type = List<ScienceExperiment>
        hidden = true

        experiments = [bd_mapping]
    }
	
	// Randomly select 2 valid biomes to study from low space.
    DATA
    {
		type = List<ScienceSubject>
        hidden = true

        scienceSubjectsTemp1 = AllScienceSubjectsByBodyExperiment([@targetBody], @experiments)
		scienceSubjectsTemp2 = @scienceSubjectsTemp1.Where(s => !s.Biome().IsKSC())
		scienceSubjectsTemp3 = @scienceSubjectsTemp2.Where(s => s.Situation() == InSpaceLow)
        scienceSubjects = @scienceSubjectsTemp3.Random(2)
    }
	
	PARAMETER
    {
        name = KH-4B Recon Satellite
        type = VesselParameterGroup
        title = Launch a new KH-4B Corona recon satellite
		
		PARAMETER
		{
			name = NewVessel
			type = NewVessel
			title = The satellite must be a new vessel
		}
		
		PARAMETER
		{
			name = Crewmembers
			type = HasCrew
			minCrew = 0
			maxCrew = 0
		}

		// Required Parts ---------------------------------
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Corona_Pod //2
			minCount = 2
			disableOnStateChange = True
		}
		PARAMETER
		{
			type = PartValidation
			part = bluedog_Keyhole_Camera_KH4B
			disableOnStateChange = True
		}
		// /Required Parts ---------------------------------
		
		//Orbit with random components to be both somewhat unpredictable and scalable to any size body. PeA needs to be below High Space to ensure both space situations are guaranteed to be within the parameters.
		PARAMETER
		{
			name = Orbit
			type = Orbit
			title = Achieve the specified polar low space orbit
			
			maxAltitude = @targetBody.AtmosphereAltitude() + 100000
			maxEccentricity = 0.02
			minInclination = Random(60,70)
			maxInclination = Random(80,90)
			disableOnStateChange = true
		}

		PARAMETER
		{
			name = ReturnHome
			type = ReturnHome
			title = Recover both film canisters
		}
    }

	PARAMETER
	{
		name = CollectScienceA
		type = CollectScience

		title = Take a photo of the specified area
		biome = @scienceSubject.Biome()
		situation = @scienceSubject.Situation()
		experiment = @scienceSubject.Experiment()
		recoveryMethod = Recover

		ITERATOR
		{
			type = ScienceSubject
			scienceSubject = @/scienceSubjects
		}
	}
}
